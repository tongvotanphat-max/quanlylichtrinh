<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Lịch Trình</title>
    
    <!-- 1. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 2. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 3. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 4. Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <!-- Custom Style -->
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob { animation: blob 7s infinite; }
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }
        .animate-spin-slow { animation: spin 8s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. CẤU HÌNH FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBdVArmwf2EgX9yBZekx78bbM99tzeM7ec",
            authDomain: "baobai-d3a4f.firebaseapp.com",
            databaseURL: "https://baobai-d3a4f-default-rtdb.firebaseio.com",
            projectId: "baobai-d3a4f",
            storageBucket: "baobai-d3a4f.firebasestorage.app",
            messagingSenderId: "576417411310",
            appId: "1:576417411310:web:030329bbc9ad2780c643ff",
            measurementId: "G-JDT8ETJXP6"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();
        const auth = firebase.auth();

        // --- 2. INLINE ICONS (FIX LỖI FORWARDREF) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Icons = {
            ChevronLeft: (props) => <IconBase {...props}><path d="m15 18-6-6 6-6"/></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>,
            Plus: (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>,
            Trash2: (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>,
            CheckCircle2: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>,
            Circle: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/></IconBase>,
            X: (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>,
            Calendar: (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></IconBase>,
            Clock: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>,
            BellRing: (props) => <IconBase {...props}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></IconBase>,
            Cloud: (props) => <IconBase {...props}><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.2-2.3-2.2-4-4.5-4-2.2 0-4.1 1.7-4.4 3.9C2.2 16.5 2 18.6 4 19h13.5z"/></IconBase>,
            Star: (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconBase>,
            Moon: (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></IconBase>,
            Sun: (props) => <IconBase {...props}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></IconBase>,
            Heart: (props) => <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>,
            Sparkles: (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></IconBase>,
            Edit2: (props) => <IconBase {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></IconBase>,
            Layout: (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></IconBase>
        };

        const { 
            ChevronLeft, ChevronRight, Plus, Trash2, CheckCircle2, 
            Circle, X, Calendar: CalendarIcon, Clock, BellRing, 
            Cloud, Star, Moon, Sun, Heart, Sparkles, 
            Edit2, Layout 
        } = Icons;

        const { useState, useEffect, useRef } = React;

        const COLORS = [
            { id: 'blue', bg: 'bg-blue-500', text: 'text-blue-500', ring: 'ring-blue-500', label: 'Công việc' },
            { id: 'red', bg: 'bg-rose-500', text: 'text-rose-500', ring: 'ring-rose-500', label: 'Quan trọng' },
            { id: 'green', bg: 'bg-emerald-500', text: 'text-emerald-500', ring: 'ring-emerald-500', label: 'Cá nhân' },
            { id: 'purple', bg: 'bg-violet-500', text: 'text-violet-500', ring: 'ring-violet-500', label: 'Học tập' },
            { id: 'orange', bg: 'bg-amber-500', text: 'text-amber-500', ring: 'ring-amber-500', label: 'Sức khỏe' },
        ];

        // --- 3. COMPONENTS ---

        const Notification = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(() => onClose(), 4000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const isSuccess = type === 'success';
            const isError = type === 'error';

            return (
                <div className={`
                    flex items-center gap-3 px-5 py-4 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.12)] 
                    transform transition-all duration-500 hover:scale-105 animate-in slide-in-from-top-5 
                    bg-white border-l-4 ${isSuccess ? 'border-emerald-500' : isError ? 'border-red-500' : 'border-blue-500'} 
                    mb-4 min-w-[320px] max-w-md z-[100] pointer-events-auto
                `}>
                    <div className={`p-2 rounded-full ${isSuccess ? 'bg-emerald-100 text-emerald-600' : isError ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}`}>
                        {isSuccess ? <CheckCircle2 size={24} /> : (isError ? <X size={24}/> : <BellRing size={24} />)}
                    </div>
                    <div className="flex-1">
                        <h4 className={`text-base font-bold ${isSuccess ? 'text-emerald-800' : isError ? 'text-red-800' : 'text-blue-800'}`}>
                            {isSuccess ? 'Thành công' : isError ? 'Lỗi' : 'Nhắc nhở'}
                        </h4>
                        <p className="text-slate-600 font-medium leading-snug">{message}</p>
                    </div>
                </div>
            );
        };

        const FloatingBackground = () => {
            // Thêm class scale-50 md:scale-100 để thu nhỏ icon trên mobile
            return (
                <div className="fixed inset-0 overflow-hidden pointer-events-none z-0 bg-slate-50">
                    <div className="absolute top-0 left-0 w-[500px] h-[500px] bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
                    <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
                    <div className="absolute -bottom-32 left-20 w-[500px] h-[500px] bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>

                    <div className="absolute top-10 left-10 text-blue-300 animate-bounce duration-[4000ms] scale-50 md:scale-100"><Cloud size={100} fill="currentColor" className="opacity-40" /></div>
                    <div className="absolute top-1/4 right-20 text-yellow-300 animate-pulse duration-[3000ms] scale-50 md:scale-100"><Star size={50} fill="currentColor" className="opacity-60" /></div>
                    <div className="absolute bottom-1/4 left-1/4 text-purple-300 animate-bounce duration-[6000ms] scale-50 md:scale-100"><Moon size={60} fill="currentColor" className="opacity-40" /></div>
                    <div className="absolute top-1/2 left-20 text-pink-300 rotate-12 animate-pulse scale-50 md:scale-100"><Heart size={40} fill="currentColor" className="opacity-50" /></div>
                    <div className="absolute top-20 right-1/3 text-emerald-300 animate-spin-slow scale-50 md:scale-100"><Sparkles size={40} /></div>
                    <div className="absolute bottom-10 right-10 text-orange-300 animate-bounce duration-[5000ms] scale-50 md:scale-100"><Sun size={80} fill="currentColor" className="opacity-40" /></div>
                </div>
            );
        };

        // --- 4. MAIN APP ---
        function App() {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(null);
            const [tasks, setTasks] = useState({}); 
            const [notifications, setNotifications] = useState([]);
            
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [newTaskText, setNewTaskText] = useState('');
            const [newTaskTime, setNewTaskTime] = useState('');
            const [selectedColor, setSelectedColor] = useState(COLORS[0].id);
            const [editingTaskId, setEditingTaskId] = useState(null);

            const addNotification = (msg, type = 'info') => {
                const id = Date.now() + Math.random(); 
                setNotifications(prev => [...prev, { id, msg, type }]);
            };
            const removeNotification = (id) => setNotifications(prev => prev.filter(n => n.id !== id));

            const getDaysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            const getFirstDayOfMonth = (date) => new Date(date.getFullYear(), date.getMonth(), 1).getDay(); 
            const formatDateKey = (date) => date.toISOString().split('T')[0];

            // --- FIREBASE LOGIC ---
            const isInitialLoad = useRef(true);

            useEffect(() => {
                auth.signInAnonymously().catch(error => {
                    console.warn("Không thể đăng nhập ẩn danh:", error);
                });

                const tasksRef = db.ref('tasks');
                
                const handleData = (snapshot) => {
                    const data = snapshot.val();
                    const loadedTasks = data || {};
                    setTasks(loadedTasks);
                    
                    if (isInitialLoad.current && data) {
                        checkUpcomingTasksInternal(loadedTasks);
                        isInitialLoad.current = false;
                    }
                };
                
                const handleError = (error) => {
                    console.error("Lỗi Firebase:", error);
                    if (error.code === 'PERMISSION_DENIED') {
                        addNotification("Lỗi quyền truy cập! Hãy cập nhật Rules trên Firebase Console.", "error");
                    }
                };

                tasksRef.on('value', handleData, handleError);

                return () => tasksRef.off();
            }, []);

            const updateFirebase = (newTasksObj) => {
                db.ref('tasks').set(newTasksObj)
                    .catch((error) => {
                        console.error("Lỗi khi lưu Firebase:", error);
                        if (error.code === 'PERMISSION_DENIED') {
                            addNotification("Không thể lưu: Bị từ chối quyền ghi (Permission Denied).", "error");
                        } else {
                            addNotification("Lỗi kết nối, không thể lưu!", "error");
                        }
                    });
            };

            const checkUpcomingTasksInternal = (loadedTasks) => {
                const now = new Date();
                const startOfToday = new Date();
                startOfToday.setHours(0,0,0,0);
                let allFutureTasks = [];

                Object.entries(loadedTasks).forEach(([dateStr, taskList]) => {
                    const taskDay = new Date(dateStr);
                    const compareDate = new Date(taskDay);
                    compareDate.setHours(0,0,0,0);

                    if (compareDate >= startOfToday && Array.isArray(taskList)) {
                        taskList.forEach(task => {
                            if (!task.completed) {
                                const sortTime = new Date(dateStr);
                                if (task.time) {
                                    const [h, m] = task.time.split(':');
                                    sortTime.setHours(h, m);
                                } else {
                                    sortTime.setHours(23, 59);
                                }
                                allFutureTasks.push({ ...task, dateStr, sortTime: sortTime.getTime() });
                            }
                        });
                    }
                });

                allFutureTasks.sort((a, b) => a.sortTime - b.sortTime);
                if (allFutureTasks.length > 0) {
                    const next = allFutureTasks[0];
                    const isToday = next.dateStr === formatDateKey(now);
                    const dateDisplay = isToday ? 'Hôm nay' : `Ngày ${next.dateStr.split('-').reverse().join('/')}`;
                    const timeDisplay = next.time ? ` lúc ${next.time}` : '';
                    addNotification(`Nhắc nhở: "${next.text}" - ${dateDisplay}${timeDisplay}`, 'info');
                }
            };

            // Calendar Navigation
            const prevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
            const nextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));

            const handleDayClick = (day) => {
                const newDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                newDate.setHours(12, 0, 0, 0); 
                setSelectedDate(newDate);
                setIsModalOpen(true);
                resetForm();
            };

            const resetForm = () => {
                setNewTaskText('');
                setNewTaskTime('');
                setSelectedColor(COLORS[0].id);
                setEditingTaskId(null);
            };

            // Task Actions
            const handleSaveTask = () => {
                if (!newTaskText.trim()) {
                    addNotification("Đừng để trống nội dung nha!", "info");
                    return;
                }

                const dateKey = formatDateKey(selectedDate);
                const currentTasks = tasks[dateKey] || [];
                let updatedList;

                if (editingTaskId) {
                    updatedList = currentTasks.map(t => 
                        t.id === editingTaskId 
                        ? { ...t, text: newTaskText, time: newTaskTime, color: selectedColor } 
                        : t
                    );
                    addNotification("Đã cập nhật công việc!", "success");
                } else {
                    const newTask = {
                        id: Date.now(),
                        text: newTaskText,
                        time: newTaskTime,
                        completed: false,
                        color: selectedColor
                    };
                    updatedList = [...currentTasks, newTask];
                    addNotification("Đã thêm công việc mới!", "success");
                }

                const newAllTasks = { ...tasks, [dateKey]: updatedList };
                updateFirebase(newAllTasks);
                resetForm();
            };

            const toggleTask = (taskId) => {
                const dateKey = formatDateKey(selectedDate);
                const updatedList = tasks[dateKey].map(t => {
                    if (t.id === taskId) return { ...t, completed: !t.completed };
                    return t;
                });
                
                const newAllTasks = { ...tasks, [dateKey]: updatedList };
                updateFirebase(newAllTasks);
            };

            const deleteTask = (taskId) => {
                const dateKey = formatDateKey(selectedDate);
                const updatedList = tasks[dateKey].filter(t => t.id !== taskId);
                const newAllTasks = { ...tasks, [dateKey]: updatedList };
                updateFirebase(newAllTasks);
                addNotification("Đã xóa công việc.", "info");
            };

            const renderCalendar = () => {
                const daysInMonth = getDaysInMonth(currentDate);
                const firstDay = getFirstDayOfMonth(currentDate);
                const days = [];

                for (let i = 0; i < firstDay; i++) {
                    days.push(<div key={`empty-${i}`} className="h-24 md:h-32 bg-transparent"></div>);
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const tempDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                    tempDate.setHours(12, 0, 0, 0); 
                    const dateKey = formatDateKey(tempDate);
                    const dayTasks = tasks[dateKey] || [];
                    const isToday = new Date().toDateString() === tempDate.toDateString();
                    const completedCount = dayTasks.filter(t => t.completed).length;
                    const progress = dayTasks.length > 0 ? (completedCount / dayTasks.length) * 100 : 0;

                    days.push(
                        <div 
                            key={day}
                            onClick={() => handleDayClick(day)}
                            className={`
                                group relative h-24 md:h-32 p-2 md:p-3 rounded-3xl cursor-pointer transition-all duration-300 ease-out
                                border border-transparent hover:border-blue-200 hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] hover:-translate-y-1
                                ${isToday ? 'bg-white ring-2 ring-blue-400 shadow-lg' : 'bg-white/80 hover:bg-white'}
                            `}
                        >
                            <div className="flex justify-between items-start mb-2">
                                <span className={`
                                    w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full text-sm md:text-xl font-bold transition-colors
                                    ${isToday ? 'bg-blue-500 text-white shadow-md' : 'text-slate-700 group-hover:bg-blue-50 group-hover:text-blue-600'}
                                `}>
                                    {day}
                                </span>
                                {dayTasks.length > 0 && (
                                    <div className="flex items-center justify-center w-5 h-5 md:w-7 md:h-7 rounded-full bg-slate-100 text-[10px] md:text-xs font-bold text-slate-500 shadow-sm">
                                        {dayTasks.length}
                                    </div>
                                )}
                            </div>
                            
                            <div className="flex flex-wrap gap-1 mb-2 ml-1">
                                {dayTasks.slice(0, 5).map((task, idx) => {
                                    const colorObj = COLORS.find(c => c.id === task.color) || COLORS[0];
                                    return (
                                        <div 
                                            key={idx} 
                                            className={`w-1.5 h-1.5 md:w-2.5 md:h-2.5 rounded-full ${colorObj.bg} ${task.completed ? 'opacity-30' : 'opacity-100'}`}
                                        />
                                    );
                                })}
                                {dayTasks.length > 5 && <span className="text-[10px] text-gray-400 leading-3">+</span>}
                            </div>

                            {dayTasks.length > 0 && (
                                <div className="absolute bottom-4 left-4 right-4 h-1 md:h-1.5 bg-gray-100 rounded-full overflow-hidden">
                                    <div 
                                        className={`h-full transition-all duration-500 rounded-full ${progress === 100 ? 'bg-emerald-400' : 'bg-blue-400'}`} 
                                        style={{ width: `${progress}%` }}
                                    />
                                </div>
                            )}
                        </div>
                    );
                }
                return days;
            };

            const WEEKDAYS = ['Chủ Nhật', 'Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7'];

            return (
                <div className="relative min-h-screen font-sans text-slate-800 selection:bg-blue-100 selection:text-blue-900 bg-slate-50">
                    <FloatingBackground />

                    <div className="fixed top-6 left-1/2 transform -translate-x-1/2 z-[100] flex flex-col items-center pointer-events-none w-full px-4">
                        <div className="pointer-events-auto w-full flex flex-col items-center">
                            {notifications.map(n => (
                                <Notification 
                                    key={n.id} 
                                    message={n.msg} 
                                    type={n.type} 
                                    onClose={() => removeNotification(n.id)} 
                                />
                            ))}
                        </div>
                    </div>

                    <div className="relative z-10 container mx-auto p-2 md:p-8 flex flex-col items-center min-h-screen">
                        
                        {/* HEADER */}
                        <div className="w-full max-w-6xl flex flex-col md:flex-row justify-between items-center mb-8 gap-6 animate-in slide-in-from-bottom-5 duration-700">
                            <div className="flex items-center gap-5">
                                <div className="bg-white p-3 md:p-4 rounded-3xl shadow-lg shadow-blue-100 text-blue-500 transform hover:rotate-12 transition-transform duration-300">
                                    <CalendarIcon size={24} className="md:w-9 md:h-9" strokeWidth={2.5} />
                                </div>
                                <div>
                                    <h1 className="text-2xl md:text-4xl font-extrabold text-slate-800 tracking-tight">Lịch Trình</h1>
                                    <div className="flex items-center gap-2 text-slate-500 font-medium mt-1 text-sm md:text-base">
                                        <Sparkles size={16} className="text-yellow-400" /> 
                                        <span>Quản lý thời gian, tận hưởng cuộc sống</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-white/80 backdrop-blur-xl p-2 rounded-2xl shadow-sm border border-white flex items-center gap-4">
                                <button onClick={prevMonth} className="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-xl hover:bg-slate-100 transition-colors text-slate-600"><ChevronLeft size={24} className="md:w-7 md:h-7"/></button>
                                <div className="text-center px-4">
                                    <div className="text-xs md:text-sm font-semibold text-slate-400 uppercase tracking-widest">Tháng {currentDate.getMonth() + 1}</div>
                                    <div className="text-xl md:text-2xl font-bold text-slate-800">{currentDate.getFullYear()}</div>
                                </div>
                                <button onClick={nextMonth} className="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-xl hover:bg-slate-100 transition-colors text-slate-600"><ChevronRight size={24} className="md:w-7 md:h-7"/></button>
                            </div>
                        </div>

                        {/* CALENDAR GRID */}
                        <div className="w-full max-w-6xl bg-white/60 backdrop-blur-2xl rounded-[30px] md:rounded-[40px] p-3 md:p-10 shadow-xl border border-white/50 animate-in fade-in duration-1000">
                            <div className="grid grid-cols-7 mb-4 md:mb-6">
                                {WEEKDAYS.map((day, idx) => (
                                    <div key={day} className={`text-center font-bold uppercase tracking-wider text-[10px] md:text-xs py-2 md:py-3 ${idx === 0 ? 'text-rose-400' : 'text-slate-400'}`}>
                                        {day}
                                    </div>
                                ))}
                            </div>
                            
                            <div className="grid grid-cols-7 gap-1 md:gap-4">
                                {renderCalendar()}
                            </div>
                        </div>
                    </div>

                    {/* MODAL */}
                    {isModalOpen && selectedDate && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                            <div className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm transition-opacity" onClick={() => setIsModalOpen(false)} />
                            
                            <div className="relative bg-white rounded-[32px] w-full max-w-lg shadow-[0_20px_50px_-12px_rgba(0,0,0,0.25)] overflow-hidden animate-in zoom-in-95 duration-300 flex flex-col max-h-[85vh]">
                                
                                <div className="bg-gradient-to-r from-blue-500 to-indigo-600 p-6 md:p-8 text-white relative">
                                    <div className="absolute top-0 right-0 p-4 opacity-10"><Cloud size={80} className="md:w-32 md:h-32" /></div>
                                    
                                    <div className="flex justify-between items-start relative z-10">
                                        <div>
                                            <div className="flex items-center gap-2 opacity-80 mb-1">
                                                <Layout size={16} />
                                                <span className="text-xs md:text-sm font-medium uppercase tracking-wider">Chi tiết ngày</span>
                                            </div>
                                            <h2 className="text-3xl md:text-4xl font-bold">
                                                {selectedDate.getDate()} <span className="text-xl md:text-2xl font-normal opacity-80">thg {selectedDate.getMonth() + 1}</span>
                                            </h2>
                                        </div>
                                        <button onClick={() => setIsModalOpen(false)} className="bg-white/20 hover:bg-white/30 p-2 rounded-full transition backdrop-blur-md">
                                            <X size={20} />
                                        </button>
                                    </div>

                                    {/* Modal Progress */}
                                    {(() => {
                                        const dateKey = formatDateKey(selectedDate);
                                        const dayTasks = tasks[dateKey] || [];
                                        const completed = dayTasks.filter(t => t.completed).length;
                                        const total = dayTasks.length;
                                        const percent = total === 0 ? 0 : Math.round((completed / total) * 100);
                                        
                                        return (
                                            <div className="mt-6">
                                                <div className="flex justify-between text-xs font-medium mb-2 opacity-90">
                                                    <span>Tiến độ: {completed}/{total} hoàn thành</span>
                                                    <span>{percent}%</span>
                                                </div>
                                                <div className="h-2 bg-black/20 rounded-full overflow-hidden backdrop-blur-sm">
                                                    <div className="h-full bg-white rounded-full transition-all duration-700 ease-out" style={{ width: `${percent}%` }} />
                                                </div>
                                            </div>
                                        );
                                    })()}
                                </div>

                                <div className="flex-1 overflow-y-auto p-4 md:p-6 bg-slate-50 scrollbar-hide">
                                    {/* Input Form */}
                                    <div className="bg-white p-4 md:p-5 rounded-2xl shadow-sm border border-slate-100 mb-6 group focus-within:ring-2 focus-within:ring-blue-200 transition-all">
                                        <input 
                                            type="text" 
                                            placeholder="Hôm nay bạn cần làm gì?" 
                                            className="w-full text-base md:text-lg font-medium text-slate-700 placeholder-slate-400 bg-transparent outline-none mb-4"
                                            value={newTaskText}
                                            onChange={(e) => setNewTaskText(e.target.value)}
                                            onKeyDown={(e) => e.key === 'Enter' && handleSaveTask()}
                                            autoFocus
                                        />
                                        
                                        <div className="flex flex-col sm:flex-row sm:items-center gap-4 border-t border-slate-50 pt-4">
                                            <div className="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100">
                                                <Clock size={16} className="text-slate-400" />
                                                <input 
                                                    type="time" 
                                                    className="bg-transparent outline-none text-sm text-slate-600 font-medium"
                                                    value={newTaskTime}
                                                    onChange={(e) => setNewTaskTime(e.target.value)}
                                                />
                                            </div>

                                            <div className="flex items-center gap-2">
                                                {COLORS.map(c => (
                                                    <button
                                                        key={c.id}
                                                        onClick={() => setSelectedColor(c.id)}
                                                        className={`w-6 h-6 rounded-full transition-transform hover:scale-110 ${c.bg} ${selectedColor === c.id ? `ring-2 ring-offset-2 ${c.ring}` : 'opacity-40 hover:opacity-80'}`}
                                                        title={c.label}
                                                    />
                                                ))}
                                            </div>

                                            <div className="flex-1"></div>
                                            
                                            <button 
                                                onClick={handleSaveTask}
                                                className="bg-slate-900 hover:bg-slate-800 text-white px-5 py-2 rounded-xl text-sm font-bold flex items-center gap-2 transition-transform active:scale-95 shadow-lg shadow-slate-200 w-full sm:w-auto justify-center"
                                            >
                                                {editingTaskId ? <Edit2 size={16} /> : <Plus size={16} />}
                                                {editingTaskId ? 'Lưu' : 'Thêm'}
                                            </button>
                                            {editingTaskId && (
                                                <button onClick={resetForm} className="text-xs text-slate-400 hover:text-slate-600 underline text-center sm:text-left">Hủy sửa</button>
                                            )}
                                        </div>
                                    </div>

                                    {/* Task List */}
                                    <div className="space-y-3">
                                        {(!tasks[formatDateKey(selectedDate)] || tasks[formatDateKey(selectedDate)].length === 0) && (
                                            <div className="flex flex-col items-center justify-center py-10 text-slate-400">
                                                <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-3">
                                                    <Sparkles className="text-slate-300" size={24}/>
                                                </div>
                                                <p className="text-sm font-medium">Chưa có công việc nào.</p>
                                                <p className="text-xs">Hãy tận hưởng ngày nghỉ hoặc thêm việc mới!</p>
                                            </div>
                                        )}

                                        {tasks[formatDateKey(selectedDate)]?.map(task => {
                                            const colorObj = COLORS.find(c => c.id === task.color) || COLORS[0];
                                            return (
                                                <div 
                                                    key={task.id} 
                                                    className={`
                                                        group relative flex items-center gap-3 md:gap-4 p-3 md:p-4 rounded-2xl border transition-all duration-300 hover:scale-[1.02]
                                                        ${task.completed ? 'bg-slate-50 border-slate-100 opacity-70' : 'bg-white border-slate-100 shadow-sm hover:shadow-md'}
                                                        ${editingTaskId === task.id ? 'ring-2 ring-blue-400' : ''}
                                                    `}
                                                >
                                                    <button 
                                                        onClick={() => toggleTask(task.id)}
                                                        className={`
                                                            flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-300
                                                            ${task.completed ? `${colorObj.bg} border-transparent` : `border-slate-300 hover:border-${colorObj.text.split('-')[1]}-400`}
                                                        `}
                                                    >
                                                        {task.completed && <CheckCircle2 size={16} className="text-white" />}
                                                    </button>
                                                    
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className={`w-2 h-2 rounded-full ${colorObj.bg}`}></span>
                                                            <span className={`text-[10px] font-bold uppercase tracking-wider text-slate-400`}>{colorObj.label}</span>
                                                        </div>
                                                        <p className={`font-semibold text-sm md:text-base truncate ${task.completed ? 'text-slate-400 line-through decoration-slate-300' : 'text-slate-700'}`}>
                                                            {task.text}
                                                        </p>
                                                        {task.time && (
                                                            <div className="flex items-center gap-1 text-xs text-slate-400 mt-1 font-medium">
                                                                <Clock size={12} /> {task.time}
                                                            </div>
                                                        )}
                                                    </div>

                                                    <div className="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                        <button 
                                                            onClick={() => startEditTask(task)}
                                                            className="p-2 text-slate-400 hover:text-blue-500 hover:bg-blue-50 rounded-lg transition-colors"
                                                            title="Chỉnh sửa"
                                                        >
                                                            <Edit2 size={18} />
                                                        </button>
                                                        <button 
                                                            onClick={() => deleteTask(task.id)}
                                                            className="p-2 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded-lg transition-colors"
                                                            title="Xóa"
                                                        >
                                                            <Trash2 size={18} />
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
